-- Azmo Scripts -- Platin Presents
-- Configurable Login System

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

-- CONFIGURATION
local USER_CREDENTIALS_URL = "https://pastefy.app/UIQaTeGN/raw"
local MAIN_SCRIPT_URL = "https://raw.githubusercontent.com/DaRealLBNH/InstantSteal/refs/heads/main/Main"

-- SET THIS TO FALSE TO DISABLE KEY SYSTEM
local KEYSYSTEM_ENABLED = true

-- Player info
local player = Players.LocalPlayer
local playerName = player.Name
local userId = player.UserId

-- Store for authorized users with their passwords
local AUTHORIZED_USERS = {}

-- File operations for session storage
local function saveSession()
    if not KEYSYSTEM_ENABLED then return true end
    
    local sessionData = {
        playerName = playerName,
        timestamp = os.time(),
        userId = userId,
        placeId = game.PlaceId
    }
    
    local jsonData = HttpService:JSONEncode(sessionData)
    
    -- Try to save to file
    local success, err = pcall(function()
        if writefile then
            writefile("AzmoScripts_Session.json", jsonData)
            return true
        end
        return false
    end)
    
    return success
end

local function loadSession()
    if not KEYSYSTEM_ENABLED then return nil end
    
    if not isfile or not readfile then return nil end
    
    if not pcall(function() return isfile("AzmoScripts_Session.json") end) then
        return nil
    end
    
    if not isfile("AzmoScripts_Session.json") then
        return nil
    end
    
    local success, data = pcall(function()
        local content = readfile("AzmoScripts_Session.json")
        return HttpService:JSONDecode(content)
    end)
    
    if success and data then
        -- Check if session is valid (7 days max) and same player
        if os.time() - data.timestamp < (7 * 24 * 60 * 60) and data.playerName == playerName then
            return data
        end
    end
    
    return nil
end

-- Load users and passwords from Pastefy (JSON format)
local function loadUserCredentials()
    if not KEYSYSTEM_ENABLED then return true end
    
    print("ðŸ“¡ Loading user credentials...")
    
    -- Try to load from Pastefy
    local success, response = pcall(function()
        return game:HttpGet(USER_CREDENTIALS_URL, true)
    end)
    
    if success and response then
        -- Try to parse as JSON
        local parseSuccess, users = pcall(function()
            return HttpService:JSONDecode(response)
        end)
        
        if parseSuccess and type(users) == "table" then
            AUTHORIZED_USERS = users
            print("âœ… Loaded " .. #users .. " users from JSON")
            return true
        else
            print("âŒ Failed to parse JSON, trying plain text format...")
            -- Fallback to plain text format
            local lines = {}
            for line in response:gmatch("[^\r\n]+") do
                table.insert(lines, line)
            end
            
            for _, line in ipairs(lines) do
                local cleanLine = line:match("^([^#]*)")
                if cleanLine and cleanLine:find(":") then
                    local username, password = cleanLine:match("^%s*(.-)%s*:%s*(.-)%s*$")
                    if username and password and username ~= "" and password ~= "" then
                        AUTHORIZED_USERS[username] = password
                    end
                end
            end
            print("âœ… Loaded " .. #lines .. " users from plain text")
            return true
        end
    else
        print("âŒ Failed to load credentials from Pastefy")
        return false
    end
end

-- Check if player is authorized (exists in the credentials list)
local function isPlayerAuthorized()
    if not KEYSYSTEM_ENABLED then return true end
    return AUTHORIZED_USERS[playerName] ~= nil
end

-- Check if password is correct for the player
local function isPasswordCorrect(password)
    if not KEYSYSTEM_ENABLED then return true end
    local correctPassword = AUTHORIZED_USERS[playerName]
    return correctPassword and password == correctPassword
end

-- Load main script without login
local function loadMainScriptDirectly()
    print("ðŸš€ Loading InstantSteal script...")
    
    local success, err = pcall(function()
        loadstring(game:HttpGet(MAIN_SCRIPT_URL))()
    end)
    
    if success then
        print("âœ… Script loaded successfully!")
    else
        warn("âŒ Failed to load script: " .. err)
        local gui = Instance.new("ScreenGui")
        gui.Name = "LoadError"
        gui.Parent = CoreGui
        
        local msg = Instance.new("TextLabel")
        msg.Size = UDim2.new(0, 300, 0, 60)
        msg.Position = UDim2.new(0.5, -150, 0, 20)
        msg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        msg.Text = "âŒ Failed to load script\n" .. err
        msg.TextColor3 = Color3.fromRGB(255, 100, 100)
        msg.Font = Enum.Font.Gotham
        msg.TextSize = 12
        msg.TextWrapped = true
        msg.Parent = gui
        
        Instance.new("UICorner", msg).CornerRadius = UDim.new(0, 8)
        
        task.wait(3)
        gui:Destroy()
    end
end

-- Create login UI with same style as God mode script
local function createLoginUI()
    local gui = Instance.new("ScreenGui")
    gui.Name = "AzmoLogin"
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui
    
    -- Background overlay
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 0.5
    background.BorderSizePixel = 0
    background.ZIndex = 0
    background.Parent = gui
    
    -- Main container
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 320, 0, 280)
    frame.Position = UDim2.new(0.5, -160, 0.5, -140)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BorderSizePixel = 0
    frame.ZIndex = 1
    frame.Parent = gui
    
    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 12)
    
    -- Thin border
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(80, 80, 80)
    stroke.Thickness = 1
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = frame
    
    -- Header
    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, 0, 0, 40)
    header.Position = UDim2.new(0, 0, 0, 10)
    header.BackgroundTransparency = 1
    header.Text = "AZMO SCRIPTS"
    header.Font = Enum.Font.GothamBold
    header.TextSize = 22
    header.TextColor3 = Color3.fromRGB(0, 170, 255)
    header.Parent = frame
    
    -- Subtitle
    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, 0, 0, 20)
    subtitle.Position = UDim2.new(0, 0, 0, 35)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "Login Required"
    subtitle.Font = Enum.Font.GothamMedium
    subtitle.TextSize = 14
    subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    subtitle.Parent = frame
    
    -- Player name display
    local playerFrame = Instance.new("Frame")
    playerFrame.Size = UDim2.new(1, -40, 0, 36)
    playerFrame.Position = UDim2.new(0, 20, 0, 70)
    playerFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    playerFrame.BorderSizePixel = 0
    playerFrame.Parent = frame
    
    Instance.new("UICorner", playerFrame).CornerRadius = UDim.new(0, 8)
    
    local playerText = Instance.new("TextLabel")
    playerText.Size = UDim2.new(1, 0, 1, 0)
    playerText.BackgroundTransparency = 1
    playerText.Text = "ðŸ‘¤ " .. playerName
    playerText.Font = Enum.Font.GothamMedium
    playerText.TextSize = 14
    playerText.TextColor3 = Color3.fromRGB(220, 220, 220)
    playerText.Parent = playerFrame
    
    -- Status indicator
    local statusIndicator = Instance.new("TextLabel")
    statusIndicator.Size = UDim2.new(0, 100, 0, 20)
    statusIndicator.Position = UDim2.new(1, -110, 0, 75)
    statusIndicator.BackgroundTransparency = 1
    statusIndicator.Text = AUTHORIZED_USERS[playerName] and "âœ… Authorized" or "âŒ Not Found"
    statusIndicator.Font = Enum.Font.Gotham
    statusIndicator.TextSize = 12
    statusIndicator.TextColor3 = AUTHORIZED_USERS[playerName] and Color3.fromRGB(0, 255, 150) or Color3.fromRGB(255, 100, 100)
    statusIndicator.Parent = frame
    
    -- Password input
    local passwordLabel = Instance.new("TextLabel")
    passwordLabel.Size = UDim2.new(1, -40, 0, 20)
    passwordLabel.Position = UDim2.new(0, 20, 0, 118)
    passwordLabel.BackgroundTransparency = 1
    passwordLabel.Text = "Enter Your Password:"
    passwordLabel.Font = Enum.Font.GothamMedium
    passwordLabel.TextSize = 13
    passwordLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    passwordLabel.TextXAlignment = Enum.TextXAlignment.Left
    passwordLabel.Parent = frame
    
    local passwordBox = Instance.new("TextBox")
    passwordBox.Size = UDim2.new(1, -40, 0, 40)
    passwordBox.Position = UDim2.new(0, 20, 0, 140)
    passwordBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    passwordBox.BorderSizePixel = 0
    passwordBox.PlaceholderText = AUTHORIZED_USERS[playerName] and "Type your password" or "Account not found"
    passwordBox.PlaceholderColor3 = AUTHORIZED_USERS[playerName] and Color3.fromRGB(120, 120, 120) or Color3.fromRGB(255, 100, 100)
    passwordBox.Text = ""
    passwordBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    passwordBox.TextSize = 15
    passwordBox.Font = Enum.Font.Gotham
    passwordBox.ClearTextOnFocus = false
    passwordBox.Parent = frame
    
    Instance.new("UICorner", passwordBox).CornerRadius = UDim.new(0, 8)
    
    -- Show/hide password button
    local showBtn = Instance.new("TextButton")
    showBtn.Size = UDim2.new(0, 30, 0, 40)
    showBtn.Position = UDim2.new(1, -50, 0, 140)
    showBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    showBtn.BorderSizePixel = 0
    showBtn.Text = "ðŸ‘"
    showBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    showBtn.TextSize = 14
    showBtn.Font = Enum.Font.Gotham
    showBtn.Parent = frame
    
    Instance.new("UICorner", showBtn).CornerRadius = UDim.new(0, 8)
    
    showBtn.MouseButton1Click:Connect(function()
        passwordBox.TextTransparency = passwordBox.TextTransparency == 0.5 and 0 or 0.5
        showBtn.Text = passwordBox.TextTransparency == 0.5 and "ðŸ‘" or "ðŸ”’"
    end)
    
    -- Login button
    local loginBtn = Instance.new("TextButton")
    loginBtn.Size = UDim2.new(1, -40, 0, 40)
    loginBtn.Position = UDim2.new(0, 20, 0, 190)
    loginBtn.BackgroundColor3 = AUTHORIZED_USERS[playerName] and Color3.fromRGB(0, 120, 220) or Color3.fromRGB(80, 80, 80)
    loginBtn.BorderSizePixel = 0
    loginBtn.Text = AUTHORIZED_USERS[playerName] and "LOGIN" or "NOT AUTHORIZED"
    loginBtn.Font = Enum.Font.GothamBold
    loginBtn.TextSize = 16
    loginBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    loginBtn.Active = AUTHORIZED_USERS[playerName] and true or false
    loginBtn.Parent = frame
    
    Instance.new("UICorner", loginBtn).CornerRadius = UDim.new(0, 8)
    
    -- Status message
    local status = Instance.new("TextLabel")
    status.Size = UDim2.new(1, -40, 0, 30)
    status.Position = UDim2.new(0, 20, 0, 240)
    status.BackgroundTransparency = 1
    status.Text = ""
    status.Font = Enum.Font.Gotham
    status.TextSize = 13
    status.TextColor3 = Color3.fromRGB(255, 100, 100)
    status.TextWrapped = true
    status.Parent = frame
    
    -- Hover effects
    if AUTHORIZED_USERS[playerName] then
        loginBtn.MouseEnter:Connect(function()
            loginBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        end)
        
        loginBtn.MouseLeave:Connect(function()
            loginBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 220)
        end)
    end
    
    showBtn.MouseEnter:Connect(function()
        showBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end)
    
    showBtn.MouseLeave:Connect(function()
        showBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)
    
    -- Enter key to submit
    passwordBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and AUTHORIZED_USERS[playerName] then
            loginBtn:Activate()
        end
    end)
    
    -- Auto-focus if authorized
    if AUTHORIZED_USERS[playerName] then
        task.spawn(function()
            task.wait(0.5)
            passwordBox:CaptureFocus()
        end)
    end
    
    return {
        Gui = gui,
        PasswordBox = passwordBox,
        LoginBtn = loginBtn,
        Status = status,
        Frame = frame,
        Background = background
    }
end

-- Main login handler
local function handleLogin()
    if not KEYSYSTEM_ENABLED then
        print("ðŸ”“ Key System: DISABLED")
        print("ðŸš€ Auto-loading InstantSteal...")
        task.wait(2)
        loadMainScriptDirectly()
        return
    end
    
    print("ðŸ” Key System: ENABLED")
    
    -- First check for saved session
    local session = loadSession()
    if session then
        print("âœ… Session found for " .. playerName)
        print("ðŸ“… Last login: " .. os.date("%Y-%m-%d %H:%M:%S", session.timestamp))
        
        -- Load script directly without showing login
        task.wait(2) -- Small delay for game to load
        loadMainScriptDirectly()
        return
    end
    
    -- No session found, proceed with normal login
    loadUserCredentials()
    
    -- Check if player is authorized
    if not isPlayerAuthorized() then
        print("â›” Player not authorized: " .. playerName)
        
        -- Show denial message
        local denyGui = Instance.new("ScreenGui")
        denyGui.Name = "AzmoDeny"
        denyGui.Parent = CoreGui
        
        local background = Instance.new("Frame")
        background.Size = UDim2.new(1, 0, 1, 0)
        background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        background.BackgroundTransparency = 0.5
        background.BorderSizePixel = 0
        background.Parent = denyGui
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 320, 0, 200)
        frame.Position = UDim2.new(0.5, -160, 0.5, -100)
        frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frame.BorderSizePixel = 0
        frame.Parent = denyGui
        
        Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(255, 80, 80)
        stroke.Thickness = 2
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = frame
        
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, 0, 0, 40)
        title.Position = UDim2.new(0, 0, 0, 10)
        title.BackgroundTransparency = 1
        title.Text = "â›” ACCOUNT NOT FOUND"
        title.Font = Enum.Font.GothamBold
        title.TextSize = 18
        title.TextColor3 = Color3.fromRGB(255, 80, 80)
        title.Parent = frame
        
        local playerInfo = Instance.new("TextLabel")
        playerInfo.Size = UDim2.new(1, -20, 0, 40)
        playerInfo.Position = UDim2.new(0, 10, 0, 50)
        playerInfo.BackgroundTransparency = 1
        playerInfo.Text = "Username: " .. playerName
        playerInfo.Font = Enum.Font.GothamMedium
        playerInfo.TextSize = 14
        playerInfo.TextColor3 = Color3.fromRGB(220, 220, 220)
        playerInfo.Parent = frame
        
        local message = Instance.new("TextLabel")
        message.Size = UDim2.new(1, -20, 0, 80)
        message.Position = UDim2.new(0, 10, 0, 90)
        message.BackgroundTransparency = 1
        message.Text = "Your account is not in the authorized list.\n\nContact administrator to add your account."
        message.Font = Enum.Font.Gotham
        message.TextSize = 14
        message.TextColor3 = Color3.fromRGB(200, 200, 200)
        message.TextWrapped = true
        message.Parent = frame
        
        task.wait(5)
        player:Kick("Account not authorized")
        return
    end
    
    -- Player is authorized, show login UI
    print("âœ… Player authorized: " .. playerName)
    local loginUI = createLoginUI()
    
    -- Login button handler
    loginUI.LoginBtn.MouseButton1Click:Connect(function()
        local password = loginUI.PasswordBox.Text
        
        if isPasswordCorrect(password) then
            -- Success
            loginUI.Status.Text = "âœ… Verified! Loading InstantSteal..."
            loginUI.Status.TextColor3 = Color3.fromRGB(0, 255, 150)
            loginUI.LoginBtn.Active = false
            loginUI.LoginBtn.Text = "LOADING..."
            loginUI.LoginBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
            
            -- Save session
            saveSession()
            
            -- Close animation
            TweenService:Create(loginUI.Frame, TweenInfo.new(0.5), {
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
            
            TweenService:Create(loginUI.Background, TweenInfo.new(0.5), {
                BackgroundTransparency = 1
            }):Play()
            
            task.wait(0.5)
            loginUI.Gui:Destroy()
            
            -- Load InstantSteal script
            loadMainScriptDirectly()
            
        else
            -- Failed
            loginUI.Status.Text = "âŒ Incorrect password"
            loginUI.Status.TextColor3 = Color3.fromRGB(255, 100, 100)
            
            -- Shake animation
            local originalPos = loginUI.Frame.Position
            for i = 1, 3 do
                TweenService:Create(loginUI.Frame, TweenInfo.new(0.08), {
                    Position = UDim2.new(0.5, -165, 0.5, -140)
                }):Play()
                task.wait(0.08)
                TweenService:Create(loginUI.Frame, TweenInfo.new(0.08), {
                    Position = UDim2.new(0.5, -155, 0.5, -140)
                }):Play()
                task.wait(0.08)
            end
            TweenService:Create(loginUI.Frame, TweenInfo.new(0.1), {
                Position = originalPos
            }):Play()
            
            -- Clear password
            loginUI.PasswordBox.Text = ""
        end
    end)
end

-- Start login system
task.spawn(function()
    task.wait(1)
    print([[
    
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘    AZMO SCRIPTS             â•‘
    â•‘    Version 2.0              â•‘
    â•‘    Configurable Login       â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ]])
    
    handleLogin()
end)
